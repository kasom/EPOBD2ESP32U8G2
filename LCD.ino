#ifdef USE_LCD

// Editor: https://xbm.jazzychad.net/
#define mainscreen_width  128
#define mainscreen_height 64
static const unsigned char mainscreen_bits[] = {
 0x55,0xfc,0xff,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 0x00,0x00,0x80,0x7f,0x57,0x02,0x00,0x08,0x00,0x00,0x00,0x00,
 0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x80,0x25,0x01,0x00,0x10,
 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x80,
 0x00,0x01,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 0x00,0x00,0x40,0x80,0xfe,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,
 0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x80,0x03,0x00,0x00,0x00,
 0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x80,
 0x19,0x28,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 0x00,0x00,0x40,0x80,0x85,0x29,0x00,0x80,0x14,0x00,0x00,0x00,
 0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x80,0x49,0x3a,0x00,0x00,
 0x12,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x80,
 0x51,0x2a,0x00,0x00,0x11,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 0x00,0x00,0x40,0x80,0x8d,0x29,0x00,0x80,0x14,0x00,0x00,0x00,
 0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x7f,0x01,0x00,0x00,0x00,
 0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,
 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,
 0x10,0x18,0xa3,0x31,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 0x01,0x00,0x00,0x00,0x10,0xa8,0x90,0x0a,0x00,0x00,0x00,0x00,
 0x80,0x1f,0xf0,0x03,0x01,0x00,0x00,0x00,0x10,0x18,0x8b,0x31,
 0x00,0x00,0x00,0x00,0x80,0x10,0x10,0x02,0x01,0x00,0x00,0x00,
 0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xfe,0xff,0xff,0xff,
 0x01,0x00,0x00,0x00,0x10,0xfe,0xff,0xff,0x00,0x00,0x00,0x00,
 0x02,0x00,0x00,0x80,0x01,0x00,0x00,0x00,0x10,0x02,0x00,0x80,
 0x00,0x00,0x00,0x03,0x02,0x00,0x00,0x80,0x01,0x00,0x00,0x00,
 0x10,0x02,0x00,0x88,0x00,0x00,0x80,0x04,0x02,0x00,0x00,0x80,
 0x01,0x00,0x00,0x00,0x10,0x02,0x00,0x80,0x00,0x00,0x80,0x07,
 0x02,0x00,0x00,0x80,0x01,0x00,0x00,0x00,0x10,0x02,0x00,0xb0,
 0x00,0x00,0x80,0x24,0x02,0x00,0x00,0x80,0x19,0x30,0x00,0x00,
 0x10,0x02,0x00,0x90,0x00,0x00,0x00,0x60,0x02,0x00,0x00,0x80,
 0x85,0x49,0x00,0x80,0x14,0x02,0x00,0xb0,0xfc,0xff,0xff,0xff,
 0x02,0x00,0x00,0x80,0x49,0x0a,0x00,0x00,0x12,0x02,0x00,0x80,
 0x00,0x00,0x00,0x60,0x02,0x00,0x00,0xa8,0x51,0x4a,0x00,0x00,
 0x11,0x02,0x00,0x80,0x00,0x00,0x80,0x28,0x02,0x00,0x00,0xa8,
 0x8d,0x31,0x00,0x80,0x14,0x02,0x00,0x80,0x00,0x00,0x80,0x0a,
 0x02,0x00,0x00,0x90,0x01,0x00,0x00,0x00,0x10,0x02,0x00,0x80,
 0x00,0x00,0x00,0x05,0x02,0x00,0x00,0x80,0x01,0x00,0x00,0x00,
 0x10,0xfe,0xff,0xff,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x80,
 0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 0xfe,0xff,0xff,0xff,0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,
 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,
 0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,
 0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
 0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,
 0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,
 0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,
 0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
 0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x11,0x00,0x00,0x00,
 0x00,0x00,0x00,0x01,0x00,0x00,0xfc,0x01,0x1d,0x00,0x00,0x00,
 0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0xc0,0x07,0x03,
 0x09,0x00,0x00,0x00,0x16,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
 0x00,0x40,0x00,0x02,0x09,0x00,0x00,0x00,0x11,0x00,0x00,0x00,
 0x00,0x00,0x00,0x01,0x00,0x40,0x00,0x02,0x09,0x00,0x00,0x00,
 0x16,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xf8,0xff,0xff,0x0f,
 0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
 0x04,0x00,0x80,0x10,0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,
 0x00,0x00,0x00,0x01,0x02,0x00,0x00,0x21,0x01,0x00,0x00,0x00,
 0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x02,0x00,0x00,0x21,
 0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
 0x01,0x00,0x10,0x42,0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,
 0x00,0x38,0x00,0x01,0x01,0x00,0xc0,0x5a,0x01,0x00,0x00,0x00,
 0x10,0x00,0x00,0x00,0x00,0x44,0x00,0x01,0x01,0x00,0x40,0x42,
 0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x7c,0x00,0x01,
 0x01,0x00,0xc0,0x5a,0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,
 0x00,0x44,0x00,0xe1,0x01,0x00,0x00,0x42,0x15,0x00,0x00,0x00,
 0x90,0x00,0x00,0x00,0x00,0x00,0x10,0x21,0x01,0x00,0x00,0x5a,
 0x15,0x00,0x00,0x00,0xd5,0xff,0xff,0xff,0xff,0xff,0x3f,0x21,
 0x01,0x00,0x00,0x42,0x15,0x00,0x00,0x00,0x95,0x00,0x00,0x00,
 0x00,0x00,0x10,0xe1,0x01,0x00,0x00,0x5a,0x09,0x00,0x00,0x00,
 0x12,0x00,0x00,0x00,0x00,0x44,0x04,0x01,0x01,0x00,0x00,0x42,
 0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x54,0x04,0x01,
 0x01,0x00,0x00,0x5a,0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,
 0x00,0x4c,0x04,0x01,0x01,0x00,0x00,0x42,0x01,0x00,0x00,0x00,
 0x10,0x00,0x00,0x00,0x00,0x54,0x05,0x01,0x01,0x00,0x00,0x5a,
 0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x94,0x02,0x01,
 0x01,0xfc,0x7f,0x42,0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,
 0x00,0x00,0x00,0x01,0x02,0x00,0x00,0x21,0x01,0x00,0x00,0x00,
 0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xe2,0xff,0x3f,0x21,
 0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
 0x04,0x00,0x80,0x10,0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00,
 0x00,0x00,0x00,0x01,0xf8,0xff,0xff,0x0f,0x03,0x00,0x00,0x00,
 0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,
 0xfe,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
 0x00,0x00,0x00,0x00};

#define ap_icon_width  9
#define ap_icon_height 11
static const unsigned char ap_icon_bits[] = {
 0x7c,0xfe,0x82,0xfe,0x38,0xfe,0x00,0xfe,0x10,0xfe,0x00,0xfe,
 0xe4,0xfe,0xaa,0xfe,0xee,0xfe,0x2a,0xfe,0x00,0xfe};

#define wifi_disconnected_icon_width  9
#define wifi_disconnected_icon_height 11
static const unsigned char wifi_disconnected_icon_bits[] = {
 0x10,0xfe,0x10,0xfe,0x10,0xfe,0x00,0xfe,0x10,0xfe,0x00,0xfe,
 0x00,0xfe,0x00,0xfe,0x00,0xfe,0x00,0xfe,0x00,0xfe};

#define wifi_connected_high_icon_width  9
#define wifi_connected_high_icon_height 11
static const unsigned char wifi_connected_high_icon_bits[] = {
 0x7c,0xfe,0x82,0xfe,0x39,0xff,0x44,0xfe,0x10,0xfe,0x00,0xfe,
 0x00,0xfe,0x00,0xfe,0x00,0xfe,0x00,0xfe,0x00,0xfe};

#define wifi_connected_low_icon_width  9
#define wifi_connected_low_icon_height 11
static const unsigned char wifi_connected_low_icon_bits[] = {
 0x00,0xfe,0x00,0xfe,0x38,0xfe,0x44,0xfe,0x10,0xfe,0x00,0xfe,
 0x00,0xfe,0x00,0xfe,0x00,0xfe,0x00,0xfe,0x00,0xfe};

 
void drawRightAlign(int x_pos_tail,int y_pos,char *text) {
  int x_pos=x_pos_tail-u8g2.getStrWidth(text);
  u8g2.drawStr(x_pos,y_pos, text);
}

void drawCenerAlign(int x_pos_center,int y_pos,char *text) {
  int x_pos=x_pos_center-u8g2.getStrWidth(text)/2;
  u8g2.drawStr(x_pos,y_pos, text);
}

#define BATT_DATA_RIGHT_POS 36

void updateLCDScreen() {
  u8g2.drawXBMP(0,0, mainscreen_width, mainscreen_height, mainscreen_bits);

  int text_center_pos=77;
  int end_pos=mainscreen_width-11;

  switch (lcd_wifi_status) {
    case LCD_WIFI_DISABLED: 
      break;
    case LCD_WIFI_DISCONNECTED:
      text_center_pos-=wifi_disconnected_icon_width/2;
      end_pos-=wifi_disconnected_icon_width;
      u8g2.drawXBMP(end_pos,0, wifi_disconnected_icon_width, wifi_disconnected_icon_height, wifi_disconnected_icon_bits);
      break;
    case LCD_WIFI_CONNECTED_LOW: 
      text_center_pos-=wifi_connected_low_icon_width/2;
      end_pos-=wifi_connected_low_icon_width;
      u8g2.drawXBMP(end_pos,0, wifi_connected_low_icon_width, wifi_connected_low_icon_height, wifi_connected_low_icon_bits);
      break;
    case LCD_WIFI_CONNECTED_HIGH: 
      text_center_pos-=wifi_connected_high_icon_width/2;
      end_pos-=wifi_connected_high_icon_width;
      u8g2.drawXBMP(end_pos,0, wifi_connected_high_icon_width, wifi_connected_high_icon_height, wifi_connected_high_icon_bits);
      break;
  }

  switch (lcd_ap_status) {
    case LCD_AP_OFF:
      break;
    case LCD_AP_ON:
      text_center_pos-=ap_icon_width/2;
      end_pos-=ap_icon_width;
      u8g2.drawXBMP(end_pos,0, ap_icon_width, ap_icon_height, ap_icon_bits);
      break;
  }

  drawCenerAlign(text_center_pos,9,lcd_text);
  
  drawRightAlign(BATT_DATA_RIGHT_POS,20, lcd_hvb_SoH);
  drawRightAlign(BATT_DATA_RIGHT_POS,36, lcd_hvb_SoC);
  drawRightAlign(BATT_DATA_RIGHT_POS,50, lcd_hvb_coolant_temp);
  drawRightAlign(BATT_DATA_RIGHT_POS,62, lcd_hvb_v);

  // HV charge/drain
  drawRightAlign(74,50, lcd_hvb_a);
  drawRightAlign(74,60, lcd_hvb_w);

  // Gear position
  drawRightAlign(127,9, lcd_gear_pos);

  // 12V batt voltage
  drawRightAlign(122,28, lcd_dc_dc_v);

  // DC-DC temp
  drawRightAlign(59,28, lcd_dc_dc_temp);

  // DC-DC A/W
  drawRightAlign(87,23, lcd_dc_dc_a);
  drawRightAlign(87,33, lcd_dc_dc_w);

  // motor temp
  drawRightAlign(116,55, lcd_motor_temp);
 
  u8g2.sendBuffer();
}

void initLCD(int contrast,int brightness) {
  ledcSetup(LCD_BL_CHANNEL,LCD_BL_FREQUENCY,LCD_BL_RESOLUTION);
  ledcAttachPin(LCD_BL_PIN,LCD_BL_CHANNEL);
  ledcWrite(LCD_BL_CHANNEL, brightness);

  u8g2.begin(); 
  u8g2.setPowerSave(0);
  u8g2.setContrast (contrast);

  //u8g2.setFont(u8g2_font_ncenB08_tr);
  u8g2.setFont(u8g2_font_minicute_tr);

  u8g2.drawStr(10,20,"Hi there!");
  u8g2.sendBuffer();
}

void setLCDBrightness(int brightness) {
  ledcWrite(LCD_BL_CHANNEL, brightness);
}

void setLCDContrast(int contrast) {
  u8g2.setContrast (contrast);
}

#endif
